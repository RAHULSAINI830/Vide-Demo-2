<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Gated YouTube video with Two HubSpot Forms</title>
  <script src="//js.hsforms.net/forms/v2.js" charset="utf-8"></script>
  <script src="https://www.youtube.com/iframe_api"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 2rem;
    }

    #hs-gate__modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .6);
      display: flex;
      align-items: center;
      justify-content: center;
      visibility: hidden;
      opacity: 0;
      transition: opacity .25s ease;
      z-index: 9999;
    }

    #hs-gate__modal.open {
      visibility: visible;
      opacity: 1;
    }

    #hs-gate__box {
      background: #fff;
      padding: 2rem;
      border-radius: 6px;
      max-width: 480px;
      width: 90%;
      box-shadow: 0 4px 20px rgba(0, 0, 0, .25);
      position: relative;
    }

    #hs-gate__close {
      position: absolute;
      top: .6rem;
      right: .8rem;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: none;
      background: rgba(0, 0, 0, .05);
      color: #333;
      font-size: 20px;
      cursor: pointer;
    }

    button#play-video {
      background: #0073e6;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 18px;
      border-radius: 6px;
      cursor: pointer;
    }

    button#play-video:hover {
      background: #005bb5;
    }
  </style>
</head>

<body>
  <h2>Watch our demo video</h2>

  <div id="video-container">
    <button id="play-video">▶ Watch Video</button>
  </div>

  <div id="hs-gate__modal">
    <div id="hs-gate__box">
      <button id="hs-gate__close">✕</button>
      <div class="hs-gate__form-frame"></div>
    </div>
  </div>

  <script>
    (() => {
      const YT_ID = 'rwG14cDNEBI';
      const FIRST_FORM_ID = '5d53e7d7-222e-40f9-a17a-4ca69a2cadb9'; // Replace with your first HubSpot form ID
      const SECOND_FORM_ID = '3083ac2d-f381-402d-b230-a47b7f449e46'; // Replace with your second HubSpot form ID
      const PORTAL_ID = '45865556';

      const firstKey = 'hsGateFirstDone';
      const secondKey = 'hsGateSecondDone';
      let player;
      let secondFormShown = false;
      let resumeTime = 0;

      const playBtn = document.getElementById('play-video');
      const modal = document.getElementById('hs-gate__modal');
      const closeBtn = document.getElementById('hs-gate__close');
      const formFrame = document.querySelector('.hs-gate__form-frame');
      const videoContainer = document.getElementById('video-container');

      // Load YouTube player
      window.onYouTubeIframeAPIReady = () => {
        player = new YT.Player('ytplayer', {
          events: {
            'onStateChange': onPlayerStateChange
          }
        });
      };

      function onPlayerStateChange(event) {
        if (event.data === YT.PlayerState.PLAYING) {
          const duration = player.getDuration();
          const interval = setInterval(() => {
            if (player.getPlayerState() !== YT.PlayerState.PLAYING) {
              clearInterval(interval);
              return;
            }
            const currentTime = player.getCurrentTime();
            if (!localStorage.getItem(secondKey) && !secondFormShown && currentTime >= duration / 2) {
              secondFormShown = true;
              resumeTime = currentTime;
              player.pauseVideo();
              showForm('second');
              clearInterval(interval);
            }
          }, 1000);
        }
      }

      function openModal() {
        modal.classList.add('open');
      }

      function closeModal() {
        modal.classList.remove('open');
      }

      function showForm(type) {
        formFrame.innerHTML = '';
        const formId = type === 'first' ? FIRST_FORM_ID : SECOND_FORM_ID;
        hbspt.forms.create({
          region: 'na1',
          portalId: PORTAL_ID,
          formId: formId,
          target: '.hs-gate__form-frame',
          onFormSubmitted: () => {
            if (type === 'first') {
              localStorage.setItem(firstKey, 'yes');
              closeModal();
              startVideo();
            } else {
              localStorage.setItem(secondKey, 'yes');
              closeModal();
              player.seekTo(resumeTime);
              player.playVideo();
            }
          }
        });
        openModal();
      }

      function startVideo() {
        videoContainer.innerHTML = `<div id="ytplayer"></div>`;
        player = new YT.Player('ytplayer', {
          videoId: YT_ID,
          playerVars: { autoplay: 1, rel: 0, mute: 1 },
          events: {
            'onStateChange': onPlayerStateChange
          }
        });
      }

      playBtn.addEventListener('click', () => {
        if (!localStorage.getItem(firstKey)) {
          showForm('first');
        } else {
          startVideo();
        }
      });

      closeBtn.addEventListener('click', closeModal);
    })();
  </script>
</body>

</html>
